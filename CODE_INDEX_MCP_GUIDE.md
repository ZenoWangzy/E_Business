# Code Index MCP 使用指南

## 📋 概述

**Code Index MCP** 是一个 Model Context Protocol 服务器，帮助 AI 助手智能地索引、搜索和分析代码仓库。

**核心能力**：
- 🔍 智能代码搜索（支持正则、模糊匹配）
- 📁 快速文件发现（Glob 模式）
- 📊 深度文件分析（AST 解析）
- 🗂️ 项目结构理解

---

## ✅ 安装状态

当前环境已配置完成：

| 组件 | 状态 |
|------|------|
| uvx | ✅ 0.9.18 |
| code-index-mcp | ✅ 2.11.0 |
| 项目配置 | ✅ 已设置 |

---

## 🚀 快速开始

### 基础搜索

```
"列出所有 Python 文件"
"查找所有 TypeScript 组件"
"搜索包含 'API' 的代码"
```

### 文件分析

```
"分析 backend/app/main.py 的结构"
"获取 frontend/src/app/layout.tsx 的摘要"
"解释这个文件的功能"
```

### 项目理解

```
"展示项目的主要目录结构"
"列出所有 API 端点文件"
"有哪些数据库模型？"
```

---

## 🎯 主要功能

### 1. 文件搜索

**基础模式**：
```
"列出所有 .py 文件"
"查找 backend 目录下的文件"
"找到所有测试文件"
```

**Glob 模式**：
```
"搜索 src/**/*.tsx"
"查找 **/*.spec.py"
```

### 2. 代码搜索

**关键词搜索**：
```
"搜索 'TODO' 注释"
"查找 'useState' 的使用"
"搜索所有 console.log"
```

**正则表达式**：
```
"搜索以 'get' 开头的函数"
"查找 'API.*_END' 模式"
```

**语言特定**：
```
"在 Python 文件中搜索 'class'"
"在 TypeScript 文件中查找 'interface'"
```

### 3. 文件分析

**结构分析**：
```
"分析这个文件的结构"
"列出文件中的所有函数"
"这个文件导入了什么？"
```

**复杂度分析**：
```
"评估这个文件的复杂度"
"找出最复杂的函数"
```

### 4. 符号搜索

**函数查找**：
```
"'findUser' 函数在哪里？"
"哪些地方调用了 'fetchProducts'？"
```

**类和接口**：
```
"找到所有继承 Component 的类"
"搜索所有 interface 定义"
```

---

## 💡 实用场景

### 代码审查

```
"查找所有需要实现的 TODO"
"搜索所有 console.log 调用"
"找到所有硬编码的配置"
```

### 重构辅助

```
"'getXxx' 函数在哪里被调用？"
"哪些文件使用了 axios？"
"查找所有重复代码"
```

### Bug 修复

```
"用户注册功能在哪里？"
"搜索所有与认证相关的代码"
"找到图片上传的实现"
```

### 学习项目

```
"这个项目的主要模块是什么？"
"列出所有的 API 端点"
"有哪些数据库表？"
```

---

## 🔧 高级技巧

### 组合搜索

```
"先列出所有 API 文件，然后分析它们"
"查找所有使用 FastAPI 的文件，并总结路由模式"
```

### 结果过滤

```
"只在 backend 目录搜索 'auth'"
"在前端文件中查找 'API'"
```

### 分页浏览

```
"搜索 'API'，显示前 20 个结果"
"查找 'useState'，每次显示 10 个"
```

---

## 📊 支持的语言

### 深度解析（AST）
- Python (.py)
- JavaScript (.js, .jsx)
- TypeScript (.ts, .tsx)
- Java (.java)
- Go (.go)
- Objective-C (.m, .mm)
- Zig (.zig)

### 基础索引（50+ 种）
- C/C++, Rust, Ruby, PHP
- Vue, Svelte, HTML, CSS
- SQL, JSON, YAML, XML
- 等 40+ 种文件类型

---

## 🛠️ 维护命令

### 刷新索引

```
"刷新项目索引"
"重新构建索引"
```

### 检查状态

```
"检查索引状态"
"查看项目配置"
```

---

## 📝 快速命令参考

```
文件搜索：
  "列出所有 X 文件"
  "查找 X 目录下的文件"

代码搜索：
  "搜索 X 关键词"
  "查找所有 X 的使用"

文件分析：
  "分析 X 文件"
  "获取 X 的摘要"

项目理解：
  "展示项目结构"
  "列出所有 X 模块"
```

---

## 🎓 最佳实践

1. **从宽到窄**：先搜索宽泛关键词，再逐步缩小范围
2. **使用 Glob**：用 `**/*.py` 这样的模式进行文件匹配
3. **组合使用**：先找文件，再分析内容
4. **正则匹配**：用正则表达式进行精确搜索

---

## 🔍 故障排除

### 工具不可用
- 确认 CLI 已重启
- 检查 `~/.claude.json` 配置
- 验证：`code-index-mcp --help`

### 搜索不准
- 运行 `refresh_index` 刷新
- 使用更具体的搜索词
- 添加文件路径过滤

### 首次慢
- 正常现象，构建索引需要时间
- 大项目可能需要几分钟
- 后续搜索会很快

---

## 📚 相关资源

- **GitHub**: https://github.com/johnhuang316/code-index-mcp
- **配置文件**: `~/.claude.json`
- **配置备份**: `~/.claude.json.backup`

---

**准备就绪！开始探索你的代码库吧！** 🚀
